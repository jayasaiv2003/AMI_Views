@{
    ViewData["Title"] = "Tariff Data";
    Layout = "~/Views/Shared/_Layout_Consumer.cshtml";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

<div class="container my-5">
    <h2 class="mb-4 text-primary">
        <i class="bi bi-cash-stack"></i> Tariff Data
    </h2>

    <!-- Tariff Table -->
    <table class="table table-bordered table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Effective From</th>
                <th>Effective To</th>
                <th>Base Rate</th>
                <th>Tax Rate</th>
            </tr>
        </thead>
        <tbody id="tariffTableBody">
            <tr>
                <td colspan="6" class="text-center text-muted">Loading tariffs...</td>
            </tr>
        </tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const tariffApi = "https://localhost:7071/api/Tariff_App";

    $(document).ready(function () {
        loadTariffs();

        // 🔹 Load all tariffs (Read-only)
        function loadTariffs() {
            $.get(`${tariffApi}/get-tariffs`, function (data) {
                if (!data || data.length === 0) {
                    $("#tariffTableBody").html('<tr><td colspan="6" class="text-center text-muted">No tariffs found.</td></tr>');
                    return;
                }

                let rows = "";
                data.forEach(t => {
                    rows += `
                        <tr>
                            <td>${t.tariffId}</td>
                            <td>${t.name}</td>
                            <td>${t.effectiveFrom ? new Date(t.effectiveFrom).toISOString().split('T')[0] : '-'}</td>
                            <td>${t.effectiveTo ? new Date(t.effectiveTo).toISOString().split('T')[0] : '-'}</td>
                            <td>${t.baseRate.toFixed(2)}</td>
                            <td>${(t.taxRate * 100).toFixed(1)}%</td>
                        </tr>`;
                });
                $("#tariffTableBody").html(rows);
            }).fail(() => {
                alert("Error loading tariffs.");
            });
        }
    });
</script>
